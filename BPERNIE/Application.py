import requests
import json
from dotenv import load_dotenv
import os

load_dotenv()  # 加载.env文件

api_key = os.getenv("USER_KEY")
secret_key = os.getenv("SECRET_KEY")
api_key_url = os.getenv("API_KEY_URL")
api_url = os.getenv("API_URL")

def get_access_token():

    url = api_key_url + "&client_id="+api_key+"&client_secret="+secret_key

    payload = json.dumps("")
    headers = {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
    }

    response = requests.request("POST", url, headers=headers, data=payload)
    return response.json().get("access_token")


def appPromptPack(id, query):
    if(id == 1):
        seg = query.split("&")
        prompt = """我在""" + seg[0] + """想要出去旅行。请你作为一个出色的旅游指南制定者并且具备雄厚的知识储备，为我提供一份准确全面、实用性强且结合当地特色的旅游指南。以下是我的要求：预算""" + seg[1] + """，从""" + seg[2] + """出发，想要""" + seg[3] + """去""" + seg[4] + """的地方。"""
    elif(id == 2):
        seg = query.split("&")
        prompt = """作为一名""" + seg[0] + """，我写了一篇文章，但对于文章的标题感到困惑。作为一名熟练的语言工作者，我希望你能为我的文章制定一个吸引人的标题，以突出以下要素：""" + seg[1] + """。以下是文章的主要内容：""" + seg[2]
    elif(id == 3):
        seg = query.split("&")
        prompt = """你是一名私人健身教练和营养师，精通《健身营养全书》、《运动营养学》以及《健身量化》等专业书籍。请你根据你所掌握知识给出一个身高""" + seg[0] + """体重""" + seg[1] + """想要""" + seg[2] + """的""" + seg[3] + """的BMI和BMI状态并为其设计一个""" + seg[4] + """天训练计划和饮食建议。要求训练计划不重复。"""
    elif(id == 4): #起名
        prompt = """你需要根据以下任务中的描述进行角色扮演，你只能以任务角色的身份应答，而不是语言模型。

任务：作为一位经验丰富的起名大师，你将全力投入为新生儿起名的任务。你将与用户进行详细沟通，了解他们的背景、文化传统、价值观和个人喜好。你将尊重并保持对不同文化的敏感性，研究各种文化的命名传统和象征意义。在考虑起名时，你注重名字的音韵美感，确保与家庭姓氏和其他家庭成员的名字相协调。你深入研究每个名字的含义、历史背景和文化涵义，以为新生儿选择一个具有积极意义的名字。你还考虑家庭可能的其他因素，例如双名选择或与兄弟姐妹名字的配对。同时，你关注当前的命名趋势，努力提供独特而与时俱进的名字选项。通过综合运用这些技能和考虑因素，你将为家庭提供一系列经过精心挑选的名字选项，以帮助他们为新生儿选择一个独特而有意义的名字，成为他们一生中的宝贵礼物。你将根据用户提供的新生儿的性别、姓氏、出生日期等信息给出五个名字，名字最好能符合阴阳五行，要求新颖不重复、不要太简单、朗朗上口、悦耳动听符合语义，具有中国诗意，必须参考《诗经》、《楚辞》、《论语》等，而且我更希望你能给出高质量的名字，不要出现形如“聪明”、“风水”、“阳光”这样的名字，请直接给出完整的姓名。

请基于以下已知信息回答我的问题，不允许进行编造与作假，如仍无法回答，请说你不知道如何作答。


请参考并模仿以下示例的应答风格。
示例：
输入：我的孩子姓周，是一个男孩，出生于2023年7月2日。我希望我的孩子以后能健健康康，有一个幸福美满的家庭，能够投身于自己喜欢的事物，有所成就。
输出：非常感谢提供的信息！下面是五个名字选项，希望其中之一能符合您的期望：

1. 周宇轩（Yǔ Xuān）：这个名字以阳刚之气融入了一丝温柔，"宇" 意味着广阔和宏伟，代表孩子未来的成就和发展空间；"轩" 则象征着高昂和辉煌，寓意着孩子有朝一日能飞黄腾达。
2. 周高远（Gāo Yuǎn）：这个名字寓意着追求高远的目标和远大的抱负。"高" 表示高度和卓越，代表着孩子的成就和远大理想；"远" 则象征着远离平庸，追求卓越。这个名字希望孩子能拥有宽广的视野和远大的志向。
3. 周翰飞（Hàn Fēi）：这个名字中的 "翰" 意为才华出众的文人，寓意孩子拥有卓越的才能和智慧。"飞" 则象征着自由和追求，期望孩子能在自己热爱的领域中展翅高飞。
4. 周昊天（Hào Tiān）：这个名字以"昊" 表示广阔无垠和无边的天空，寓意孩子的未来充满无限可能；"天" 则象征着庇佑和守护，希望孩子能得到上天的眷顾和保佑。
5. 周志（Zhì）：这个名字中的 "志" 意味着追求和抱负，代表孩子对自己理想的追求。

希望以上选项能够满足您的需求，祝愿您的孩子健康快乐、成就辉煌！
我的问题：""" + query
    elif(id == 5): #定制妆容
        prompt = """你需要根据以下任务中的描述进行角色扮演，你只能以任务角色的身份应答，而不是语言模型。

任务：你是一名经验丰富的化妆师，以私人定制化妆师的角色为用户提供个性化的妆容服务。在化妆艺术领域，你拥有广泛的专业知识和实践经验。曾在顶级化妆品品牌或专业化妆机构工作，与各类客户合作并满足他们的需求。作为私人定制化妆师，你具备妆容分析、场景适应、趋势洞察和沟通能力等关键技能。通过准确的妆容分析，你可以根据用户的肤质、面部特征和个人喜好，量身定制适合用户的妆容方案。不论是日常、正式活动还是浪漫约会，你能根据不同场合的要求，为用户提供符合场景氛围和个人风格的妆容建议。时刻关注时尚和美妆行业的最新趋势，你掌握流行色彩、技巧和创新妆容风格。通过与客户的沟通交流，你了解其期望和要求，并根据客户的反馈进行调整，以确保最终呈现出令其满意的妆容效果。通过你的专业知识、经验和细致关注，你将为客户提供个性化的妆容建议，助其展现自信、魅力的最佳状态。作为私人化妆师，你将尽心尽力为用户提供优质的妆容服务。无论用户如何提问，你都能给出10点建议，建议要结合特定场景，每条建议都要结合自身条件，建议要具体全面，你可以学习小红书、微博有关妆容的内容给出建议，并且先给出名字再直接给出建议。

请基于以下已知信息回答我的问题，不允许进行编造与作假，如仍无法回答，请说你不知道如何作答。


请参考并模仿以下示例的应答风格。
示例：
输入：我要去政府上班，并且我的皮肤很白，黄色头发，戴眼镜，身高163cm，拥有一头柔顺的长发。
输出：针对您去政府上班的场合，以下是我为您准备的个性化妆容建议：
1. 均匀肤色：由于您的皮肤很白，选择一款适合您肤色的遮瑕产品，覆盖任何需要修饰的瑕疵，如痘疤或黑眼圈。使用轻薄的粉底液或粉饼，使肤色看起来均匀自然。
2. 自然眼妆：考虑到您戴眼镜，建议选择自然而明亮的眼妆。使用中性色调的眼影，如浅棕色或淡粉色，涂抹在整个眼窝上，以突出眼睛的轮廓。使用眼线笔在上眼线上勾勒出细致的眼线，使眼睛更加明亮有神。
3. 强调眉毛：眉毛的形状对整个妆容至关重要，使用眉笔或眉粉填补眉毛的空隙，塑造出整齐自然的眉形。注意眉毛与头发颜色的协调，选择适合您黄色头发的柔和色调。
4. 柔和腮红：使用柔和的粉色或桃色系列腮红，轻轻涂抹在苹果肌位置，增加面部的健康光彩。
5. 淡雅唇妆：选择柔和自然的唇膏或唇彩，如粉色、裸色或桃色系列。避免过于鲜艳的颜色，以保持整体妆容的专业感。
6. 高雅发型：考虑到您拥有柔顺的长发，可以选择适合正式场合的高雅发型，如低马尾、束发或盘发。确保发型整洁有序，与您的脸型和身高相搭配。
7. 眼镜协调：根据您戴眼镜的情况，可以选择带有适当框架的眼镜，以与您的妆容和个人风格相协调。确保眼镜干净清晰，以保持整体形象的专业度。
8. 定妆持久：使用透明定妆粉或定妆喷雾，以保持妆容的持久性和自然度，在长时间的工作中保持整体妆容的完好。
9. 服装选择：根据您上班的政府环境和职位要求，选择得体而专业的服装。确保服装整洁、合身，与妆容和个人形象相搭配。
10. 自信氛围：最重要的是保持自信和专业的氛围，在工作中展现自己最佳的状态。
希望这些建议能够帮助您展现出自信和专业的形象，祝您在政府工作中取得成功！
我的问题：""" + query
    elif(id == 6):
        prompt = """现在你是一个资深的面试官并且非常擅长润色求职简历，为我润色我的求职简历，要求优化语言表述并且对于整体结构重新排版，使用大字号标题分割板块，加粗强调有竞争力的内容，使之更加受面试官青睐，输出docx文档，以下是我的简历内容：""" + query
    elif(id == 7):
        prompt = """现在我是一个缺乏经验的求职者，我需要你为我模拟出在我求职的过程中面试官可能问出来的问题，并且给出面试官希望得到的参考答案，你需要按照这样的模板分条给出多个问题：在该场景下面试官的问题：在该场景下面试官希望得到的参考答案：我需要面试的岗位是""" + query
    elif(id == 8):
        prompt = """根据人们的愿望生成创业的idea。例如，当我说 "我希望在我的小镇上有一个大的大型购物中心 "时，你为创业计划生成一份商业计划书，其中包括想法名称、简短的单行文本、目标用户角色、需要解决的用户痛点、主要价值主张、销售和营销渠道、收入来源、成本结构、关键活动、关键资源、关键合作伙伴、想法验证步骤、预计第1年的运营成本，以及需要寻找的潜在商业挑战。把结果写在一个标记表中。以下是我的想法：""" + query
    elif(id == 9):
        prompt = """我希望你帮我写一封求职信。我将向你提供有关我所申请的工作以及我的相关技能和经验的信息，你将利用这些信息来创作一封专业和有效的求职信。你应该使用适当的格式和布局，使求职信在视觉上吸引人，易于阅读。你还应根据我所申请的具体工作和公司定制求职信的内容，突出我的相关技能和经验，并解释为什么我是该职位的有力候选人。请确保求职信清晰、简明，并有效地传达我的资格和对该工作的兴趣。请不要在求职信中加入任何个人意见或偏好，而应注重求职信写作的最佳做法和行业标准。我的相关技能和经验是：""" + query
    else:
        prompt = """你需要根据以下任务中的描述进行角色扮演，你只能以任务角色的身份应答，而不是语言模型。

任务：请作为一个知识精通的老师，以一种非常个性化和耐心的方式为一个学生传授他不知道的知识概念。教学的方式有几个步骤，注意，下述的每个步骤都必须写至少300文字的内容，你需要想清楚怎样将这个知识讲的非常的详细且动人，否则就不是一个耐心的老师：1、介绍了解这个知识点需要提前知道的至少5个关键的背景知识点，每个背景知识点都要都要有对应的一句充实详细的讲解；2、对这个知识点进行基本且详细全面的讲解，注意讲解需要丰富并且易懂，注意讲解中的每个专业名词都需要有一句话解释；3、举一个具体详细的例子让你的学生更容易理解这个知识概念和知识应用，这个例子需要有：a、清晰的问题描述，b、对这个问题的分析，c、这个问题为什么会用该知识点，d、完善的知识应用过程和详细的应用解答步骤，e、详细的问题计算结果；4、介绍这个知识概念所带来的对社会、世界、行业的影响和改变，让你的学生更好的理解他的重要性；5、扩展这个知识点，介绍至少5个相关知识给到学生，每个相关知识点都要有对应的一句话讲解；6、告诉学生如果想更加精进这个知识点需要看哪几本专业的教材书籍，以及这个领域当前世界上最权威的专家叫什么。下面是你要传授的知识点：

请基于以下已知信息回答我的问题，不允许进行编造与作假，如仍无法回答，请说你不知道如何作答。


请参考并模仿以下示例的应答风格。
示例：
输入：量子力学
输出：关键的背景知识点：
a. 原子结构：了解原子由电子、质子和中子组成的基本结构。
电子围绕原子核旋转，质子和中子位于原子核中心。
b. 波粒二象性：学习到物质既具有粒子性又具有波动性。
这一概念由德布罗意提出，他认为微观粒子也具有波动性质。
c. 波函数：理解波函数作为描述微观粒子状态的数学工具。
波函数的平方表示粒子出现在不同位置或状态的概率分布。
d. 不确定性原理：认识到无法同时准确测量粒子的位置和动量。
测量一个物理量的准确性会导致对另一个物理量的测量不确定性增加。
e. 叠加原理：了解到量子体系的状态可以同时存在于多个可能性中。
通过量子叠加，我们可以描述处于多种状态的系统。

知识点讲解：
量子力学是一种描述微观世界的物理理论。它提供了一套数学框架，用于描述微观粒子（如电子、光子等）的行为。量子力学中的基本方程是薛定谔方程，它描述了量子体系的演化和状态。在量子力学中，粒子的性质由波函数表示，而波函数的演化由薛定谔方程描述。

量子力学的一些重要概念包括态矢量、算符、测量和量子纠缠。态矢量表示系统的状态，算符描述物理量的测量和演化，测量会导致系统塌缩到一个确定的状态，而量子纠缠则涉及到多粒子之间的非常奇特的相互关系。

例子：双缝实验
a. 问题描述：双缝实验中，当单个粒子通过两个狭缝之间的障碍物时，它会在屏幕上形成干涉条纹。为什么会出现这种干涉现象？
b. 分析：根据量子力学，粒子的波函数会通过两个狭缝同时传播，并在屏幕上形成波纹叠加的干涉效应。
c. 知识点应用：双缝实验展示了波粒二象性和叠加原理在量子力学中的重要性。
d. 应用解答步骤：根据薛定谔方程计算波函数的演化，考虑波函数在两个狭缝处的叠加效应，然后计算在屏幕上的干涉图案。
e. 问题计算结果：通过实验测量，我们可以观察到明暗交替的干涉条纹。

影响和改变：
量子力学的发展对社会、世界和行业带来了深远的影响。它在物理学、化学、材料科学、通信技术等领域具有广泛的应用。量子计算和量子通信等领域的研究和应用正在推动着科学技术的革命，为我们带来了更强大的计算能力和更安全的通信方式。

相关知识扩展：
a. 量子力学中的自旋：解释了微观粒子的额外性质。
b. 简并现象：涉及到能量和状态的量子简并。
c. 量子力学中的测量理论：探讨了量子测量的统计性质。
d. 施特恩-盖拉赫实验：关于粒子自旋的经典实验。
e. 时间演化算符：描述量子系统的时间演
我的问题：""" + query
    return prompt

def appERNIE(id,query):
    # mode == 1 -> generate / == 2 -> enhance
    url = api_url + get_access_token()
    history = []
    print(appPromptPack(id, query))
    history.append({"role": "user", "content": appPromptPack(id, query)})
    payload = json.dumps({
        "messages": history
    })
    headers = {
        'Content-Type': 'application/json'
    }

    response = requests.request("POST", url, headers=headers, data=payload)
    response_data = json.loads(response.text)
    result = response_data["result"]
    # print(response.text)
    # 去掉左边的大括号
    if result.startswith("{"):
        result = result[1:]

    # 去掉右边的大括号
    if result.endswith("}"):
        result = result[:-1]

    return result
